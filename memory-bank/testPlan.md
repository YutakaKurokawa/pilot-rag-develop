# Test Policy & Plan
## 1. Test Objectives and Scope
1. **目的**  
   - プロジェクトの最終成果物（RAGチャットボット）が、事前に定義した品質基準を満たしていることを確認。  
   - 機能面・性能面・セキュリティ面の不具合を早期に検出・修正する。

2. **対象スコープ**  
   - **機能テスト対象**  
     1. チャットUI（すでに v0 で実装済み）  
     2. FAQ検索・DB連携機能  
     3. AIフォールバック（RAG部分）  
     4. ファイルインポート(FAQデータCSV)  
     5. 認証／認可（admin, user ロール）  
   - **限定対象**  
     - インフラ構築(ネットワーク設定, AWS/ECS など)は接続確認程度。  
     - 運用フェーズの詳細監視・緊急対応プロセスはテスト外。

## 2. Test Types & Approach
### 2.1 Lint (静的解析)
- **ツール**: ESLint  
- **目的**: コード規約・型エラーなどを検出し、品質を底上げ。  
- **運用**: GitHub Actionsなどで自動実行 → フェイルならマージ不可。

### 2.2 Unit Tests (単体テスト)
- **フレームワーク**: Jest or Vitest  
- **カバレッジ目標**: 80%以上（#7.2）  
- **対象**: 各モジュールやクラス単位での機能確認。  
- **戦略**: RAGコア部分（FAQ検索・AIフォールバック）はテスト重点対象（90%超を目指す）。

### 2.3 Integration Tests (結合テスト)
- **目的**: DB/API連携や外部AIコールが正しく組み合わさっているか検証。  
- **内容**:  
  1) /api/chat → DB検索 + AIフォールバック  
  2) CSVインポート → DB書き込み  
- **実施環境**: ステージングDB or 実DB(モックデータ)

### 2.4 Load Tests (負荷試験)
- **想定負荷**: 同時10~50req/sec程度  
- **合格ライン**: 3秒以内の応答、エラー率1%以下  
- **ツール**: k6, JMeterなどを使用  

### 2.5 Security Tests (脆弱性検証)
- **方針**: OWASP Top10 (XSS/SQLi/CSRF)をチェックし、Highリスクが0件になること  
- **ツール**: npm audit, Snyk, 自動スキャン  
- **クライアントサイド**: CSRFトークン、Reactエスケープ確認

## 3. Quality Criteria (from the Project's Quality Standards)
1. **機能的正確性**  
   - FAQ回答の正答率70%以上  
   - 誤回答しない（回答不可案件は適切に回答拒否）  
   - CSVインポートで全レコードが正しくDBへ反映

2. **信頼性・可用性**  
   - 致命的エラー(クリティカルバグ) 0件  
   - 基本稼働率99.0%以上を目指す(長期モニタリングで確認)

3. **セキュリティ**  
   - 認証ないとFAQ編集不可  
   - OWASP重大リスク0件  

4. **パフォーマンス**  
   - 3秒以内応答(通常負荷)  
   - 負荷時のエラー率1%以下  

5. **可観測性・保守性**  
   - ログが一元管理され、エラー時のスタックトレース有  
   - インテグレーションテストで問題なければリリース可

## 4. Coverage Target
- **単体テスト**: 80%以上  
- **重要モジュール** (FAQ回答ロジック、AIフォールバック): 90%以上  
- カバレッジレポートを**PRごとに可視化**し、CIで失敗時はブロック。


## 5. Code Review Criteria
- 型エラーなし、不必要な `any` 禁止  
- OWASP観点 (XSS/SQLi/CSRF) のチェック  
- 1名以上の承認必須(プルリクエスト)

## 6. Test Plan Details
### 6.1 テストフェーズとスケジュール
1. **Phase 1**: Lint & Unit Test  
   - コード完成後すぐ着手  
   - カバレッジ80%必達でCI通過  
2. **Phase 2**: Integration / E2E Test  
   - ステージング環境でDB/API連携やAIフォールバックを検証  
   - CSVインポート機能もテスト  
3. **Phase 3**: 負荷試験 & セキュリティテスト  
   - Load Tool (k6/JMeter)  
   - npm audit / Snyk  
   - 3秒以内応答 & High脆弱性0件を目標  
4. **Phase 4**: 修正 & 回帰テスト → リリース承認

### 6.2 テスト環境
- **Dev環境**: ローカル or Docker Compose  
  - 単体テスト / 簡易結合テスト  
- **Staging環境**: 実DB or Staging DB, CI/CDでデプロイ  
  - Integration / E2E / 負荷試験 / セキュリティスキャン  
- **本番環境**: 運用監視を主に行い、大きな改修前に再テスト

## 7. Test Items (大分類)

| テスト項目           | 内容                                                 | 参考品質基準                       |
|----------------------|------------------------------------------------------|------------------------------------|
| UIチャット動作       | /api/chat 経由で質問→回答がUIに表示される            | 機能的正確性, ユーザビリティ       |
| FAQ検索(ローカルDB) | query→DB検索→回答 or Not Found                      | 機能的正確性                       |
| AIフォールバック     | DBに無い質問→外部AI呼び出し→回答(丁寧に)             | 機能的正確性                       |
| CSVインポート        | /api/faq-import, ファイルサイズ/拡張子チェック       | 機能的正確性, セキュリティ         |
| 認証/認可           | ログイン必須, adminロールのみ編集可                  | セキュリティ                        |
| 負荷試験            | 10〜50req/sec で応答3秒以内, エラー率1%以下           | パフォーマンス                     |
| セキュリティスキャン| XSS/SQLi/CSRF, npm audit Highリスク0件               | セキュリティ                        |
| ロギング/監視       | Error時スタックトレース出力, CPU80%時アラート         | 可観測性                           |

## 8. Entry & Exit Criteria
1. **Entry Criteria**  
   - コード完成(主要API & DB連携, AIフォールバック)  
   - 単体テスト80%カバレッジ → CI通過  

2. **Exit Criteria**  
   - 全機能テストケースの95%以上Pass、Criticalバグ0件  
   - 負荷試験/セキュリティスキャン問題なし  
   - PM/QAリーダー承認

## 9. Roles & Responsibilities
- **QAリーダー**: テスト計画策定、スケジュール管理  
- **開発リーダー**: 不具合修正、テスト環境セットアップ  
- **テスター/QAメンバー**: テスト実行、結果レポート  
- **PM**: 最終判断、リリースGO/NOGO


## 10. Automation
- CIで `npm run test` 実行、失敗時はデプロイ不可  
- カバレッジレポートをPull Requestごとに可視化  
- Lint/Unit/Integrationを自動化し、E2E/負荷/セキュリティも可能な範囲でスクリプト化

## 11. Risk and Contingency
- **AI回答の変動**: モデル更新・負荷状況で回答品質が変わる → 定期的にサンプルテスト実施  
- **インフラ差異**: Stagingと本番で性能ギャップ → 安全余裕をみる  
- **セキュリティ誤検出**: スキャンツール設定の見直しが必要な場合あり

## 12. Deliverables
- **Test Cases**: 機能単位のテストケース表（入力／期待結果／実測）  
- **Test Reports**: 不具合一覧、カバレッジ報告、実施結果(合格/失敗)数  
- **Defect Tracking**: Jira/Redmine等でバグ管理  
- **Sign-off**: 全Pass後リリース許可
